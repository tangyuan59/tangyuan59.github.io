<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="ZooKeeper, tangyuan&#39;s blog">
    <meta name="description" content="Zookeeper1 ZooKeeper基础1.1为什么使用ZooKeeper
   Nginx作为负载均衡管理大量服务器时，管理起来比较麻烦，可以通过zookeeper注册服务与发现服务协作管理。
   以前大部分应用需要开发私有的协调程">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>ZooKeeper | tangyuan&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">tangyuan&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">tangyuan&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/tangyuan59/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/tangyuan59/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/12.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">ZooKeeper</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/ZooKeeper/">
                                <span class="chip bg-color">ZooKeeper</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="post-category">
                                大数据
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-12-21
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    22 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><h3 id="1-ZooKeeper基础"><a href="#1-ZooKeeper基础" class="headerlink" title="1 ZooKeeper基础"></a>1 ZooKeeper基础</h3><h4 id="1-1为什么使用ZooKeeper"><a href="#1-1为什么使用ZooKeeper" class="headerlink" title="1.1为什么使用ZooKeeper"></a>1.1为什么使用ZooKeeper</h4><ol>
<li>   Nginx作为负载均衡管理大量服务器时，管理起来比较麻烦，可以通过zookeeper注册服务与发现服务协作管理。</li>
<li>   以前大部分应用需要开发私有的协调程序，缺乏一个通用的机制协调程序的反复编写浪费，且难以形成通用、伸缩性好的协调器</li>
<li>   使用分布式部署后，多线程安全的问题，以前学的同步代码块、重构锁、读写锁等通通失效，怎么办？</li>
</ol>
<h4 id="1-2-Zookeeper·概述"><a href="#1-2-Zookeeper·概述" class="headerlink" title="1.2 Zookeeper·概述"></a>1.2 Zookeeper·概述</h4><h5 id="1-2-1-ZooKeeper简介"><a href="#1-2-1-ZooKeeper简介" class="headerlink" title="1.2.1 ZooKeeper简介"></a>1.2.1 ZooKeeper简介</h5><p>ZooKeeper：动物园管理员<br>ZooKeeper是分布式应用程序的协调服务框架，是Hadoop的重要组件。ZooKeeper是Google的Chubby一个开源的实现，是Hadoop的分布式协调服务，包含一个简单的原语集，分布式应用程序可以基于它实现。</p>
<h5 id="1-2-2-具体应用场景"><a href="#1-2-2-具体应用场景" class="headerlink" title="1.2.2 具体应用场景"></a>1.2.2 具体应用场景</h5><ol>
<li>   Hadoop,使用ZooKeeper的事件处理确保整个集群只有一个NameNode,存储配置信息等.<br><a target="_blank" rel="noopener" href="https://ibb.co/mJLWCJK">ZooKeeper_in_hadoop</a></li>
<li>   HBase,使用ZooKeeper的事件处理确保整个集群只有一个HMaster,察觉HRegionServer联机和宕机,存储访问控制列表等.</li>
</ol>
<h3 id="1-3-分布式编程容易出现的问题"><a href="#1-3-分布式编程容易出现的问题" class="headerlink" title="1.3 分布式编程容易出现的问题"></a>1.3 分布式编程容易出现的问题</h3><p>分布式的思想就是人多干活快，即用多台机器同时处理一个任务。分布式的编程和单机的编程 思想是不同的，随之也带来新的问题和挑战。<br>1.活锁。<br>活锁定义：在程序里，由于某些条件的发生碰撞，导致重新执行，再碰撞=》再执 行，如此循环往复，就形成了活锁。活锁的危害：多个线程争用一个资源，但是没有任何一个 线程能拿到这个资源。（死锁是有一个线程拿到资源，但相互等待互不释放造成死锁），活锁 是死锁的变种。补充：活锁更深层次的危害，很耗尽Cpu资源（在做无意义的调度）<br>2.需要考虑集群的管理问题，需要有一套机制来检测到集群里节点的状态变化。<br>3.如果用一台机器做集群管理，存在单点故障问题，所以针对集群管理，也需要形成一个集群<br>4.管理集群里Leader的选举问题（要根据一定的算法和规则来选举），包括要考虑Leader挂掉 之后，如何从剩余的follower里选出Leader<br>5.分布式锁的实现，用之前学的重入锁，同步代码块是做不了的</p>
<h3 id="1-4-Paxos的小岛的故事"><a href="#1-4-Paxos的小岛的故事" class="headerlink" title="1.4    Paxos的小岛的故事"></a>1.4    Paxos的小岛的故事</h3><p>那么ZooKeeper最基础的东西是什么呢？不得不提Paxos，它是一个基于消息传递的一致性算法，Leslie Lamport（莱斯利·兰伯特）在1990年提出，近几年被广泛应用于分布式计算中，Google的Chubby，Apache的ZooKeeper都是基于它的理论来实现的，Paxos还被认为是到目前为止唯一的分布式一致性算法，其它的算法都是Paxos的改进或简化。有个问题要提一下，Paxos有一个前提：没有拜占庭将军问题。就是说Paxos只有在一个可信的计算环境中才能成立，这个环境是不会被入侵所破坏的。<br>Paxos描述了这样一个场景，有一个叫做Paxos的小岛(Island)上面住了一批居民，岛上面所有的事情由一些特殊的人决定，他们叫做议员(Senator)。议员的总数(Senator Count)是确定的，不能更改。岛上每次环境事务的变更都需要通过一个提议(Proposal)，每个提议都有一个编号(PID)，这个编号是一直增长的，不能倒退。每个提议都需要超过半数((Senator Count)/2 +1)的议员同意才能生效。每个议员只会同意大于当前编号的提议，包括已生效的和未生效的。如果议员收到小于等于当前编号的提议，他会拒绝，并告知对方：你的提议已经有人提过了。这里的当前编号是每个议员在自己记事本上面记录的编号，他不断更新这个编号。整个议会不能保证所有议员记事本上的编号总是相同的。现在议会有一个目标：保证所有的议员对于提议都能达成一致的看法<br>好，现在议会开始运作，所有议员一开始记事本上面记录的编号都是0。有一个议员发了一个提议：将电费设定为1元/度。他首先看了一下记事本，嗯，当前提议编号是0，那么我的这个提议的编号就是1，于是他给所有议员发消息：1号提议，设定电费1元/度。其他议员收到消息以后查了一下记事本，哦，当前提议编号是0，这个提议可接受，于是他记录下这个提议并回复：我接受你的1号提议，同时他在记事本上记录：当前提议编号为1。发起提议的议员收到了超过半数的回复，立即给所有人发通知：1号提议生效！收到的议员会修改他的记事本，将1好提议由记录改成正式的法令，当有人问他电费为多少时，他会查看法令并告诉对方：1元/度<br>现在看冲突的解决：假设总共有三个议员S1-S3，S1和S2同时发起了一个提议:1号提议，设定电费。S1想设为1元/度, S2想设为2元/度。结果S3先收到了S1的提议，于是他做了和前面同样的操作。紧接着他又收到了S2的提议，结果他一查记事本，咦，这个提议的编号小于等于我的当前编号1，于是他拒绝了这个提议：对不起，这个提议先前提过了。于是S2的提议被拒绝，S1正式发布了提议: 1号提议生效。S2向S1或者S3打听并更新了1号法令的内容，然后他可以选择继续发起2号提议<br>好，我觉得Paxos的精华就这么多内容。现在让我们来对号入座，看看在ZK Server里面Paxos是如何得以贯彻实施的</p>
<p>小岛(Island)——ZK Server Cluster<br>议员(Senator)——ZK Server<br>提议(Proposal)——ZNode Change(Create/Delete/SetData…)<br>提议编号(PID)——Zxid(ZooKeeper Transaction Id)<br>正式法令——所有ZNode及其数据</p>
<p>貌似关键的概念都能一一对应上，但是等一下，Paxos岛上的议员应该是人人平等的吧，而ZK Server好像有一个Leader的概念。没错，其实Leader的概念也应该属于Paxos范畴的。如果议员人人平等，在某种情况下会由于提议的冲突而产生一个“活锁”（所谓活锁我的理解是大家都没有死，都在动，但是一直解决不了冲突问题）。Paxos的作者Lamport在他的文章”The Part-Time Parliament“中阐述了这个问题并给出了解决方案——在所有议员中设立一个总统，只有总统有权发出提议，如果议员有自己的提议，必须发给总统并由总统来提出。<br>好，我们又多了一个角色：总统。<br>总统——ZK Server Leader</p>
<h3 id="1-5-ZooKeeper集群"><a href="#1-5-ZooKeeper集群" class="headerlink" title="1.5    ZooKeeper集群"></a>1.5    ZooKeeper集群</h3><p>攘其外：消息队列<br>安其内：选举<br>现在我们假设总统已经选好了，下面看看ZK 是怎么实施的。<br>情况一：<br>总统突然挂了，议员接二连三的发现联系不上总统，于是各自发表声明，推选新的总统，总统大选期间政府停业，拒绝屁民的请求。呵呵，到此为止吧，当然还有很多其他的情况，但这些情况总是能在Paxos的算法中找到原型并加以解决。这也正是我们认为Paxos是<br>ZooKeeper的灵魂的原因。当然ZK还有很多属于自己特性的东西：Session, Watcher，Version等等。</p>
<p>情况二：<br>屁民甲(Client)到某个议员(ZK Server)那里询问(Get)某条法令的情况(ZNode的数据)，议员毫不犹豫的拿出他的记事本(local storage)，查阅法令并告诉他结果，同时声明：我的数据不一定是最新的。你想要最新的数据？没问题，等着，等我找总统Sync一下再告诉你。</p>
<p>情况三：<br>屁民乙(Client)到某个议员(ZK Server)那里要求政府归还欠他的一万元钱，议员让他在办公室等着，自己将问题反映给了总统，总统询问所有议员的意见，多数议员表示欠屁民的钱一定要还，于是总统发表声明，从国库中拿出一万元还债，国库总资产由100万变成99万。屁民乙拿到钱回去了(Client函数返回)</p>
<h2 id="2-ZooKeeper集群分布式安装"><a href="#2-ZooKeeper集群分布式安装" class="headerlink" title="2 ZooKeeper集群分布式安装"></a>2 ZooKeeper集群分布式安装</h2><h3 id="2-1-四台服务器之间免密登录"><a href="#2-1-四台服务器之间免密登录" class="headerlink" title="2.1    四台服务器之间免密登录"></a>2.1    四台服务器之间免密登录</h3><p>四台服务器之间互相均可以免密登录<br>a、    首先在四台服务器上都要执行：</p>
<pre class="line-numbers language-none"><code class="language-none">ssh-keygen  -t  dsa  -P  &#39;&#39;  -f  ~&#x2F;.ssh&#x2F;id_dsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>b、在node1上将node1 的公钥拷贝到authorized_keys中：</p>
<pre class="line-numbers language-none"><code class="language-none">cat  ~&#x2F;.ssh&#x2F;id_dsa.pub  &gt;&gt;  ~&#x2F;.ssh&#x2F;authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>c、在node2中将node2的公钥追加到authorized_keys中：</p>
<pre class="line-numbers language-none"><code class="language-none">cat  ~&#x2F;.ssh&#x2F;id_dsa.pub  &gt;&gt;  ~&#x2F;.ssh&#x2F;authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将该文件拷贝给node3：</p>
<pre class="line-numbers language-none"><code class="language-none">scp  ~&#x2F;.ssh&#x2F;authorized_keys   node3:&#x2F;root&#x2F;.ssh&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>d、在node3中将node3的公钥追加到authorized_keys中：</p>
<pre class="line-numbers language-none"><code class="language-none">cat  ~&#x2F;.ssh&#x2F;id_dsa.pub  &gt;&gt;  ~&#x2F;.ssh&#x2F;authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将该文件拷贝给node4：</p>
<pre class="line-numbers language-none"><code class="language-none">scp  ~&#x2F;.ssh&#x2F;authorized_keys   node4:&#x2F;root&#x2F;.ssh&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>e、在node4中将node4的公钥追加到authorized_keys中：</p>
<pre class="line-numbers language-none"><code class="language-none">cat  ~&#x2F;.ssh&#x2F;id_dsa.pub  &gt;&gt;  ~&#x2F;.ssh&#x2F;authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将该文件拷贝给node1、node2、node3：</p>
<pre class="line-numbers language-none"><code class="language-none">scp  ~&#x2F;.ssh&#x2F;authorized_keys   node1:&#x2F;root&#x2F;.ssh&#x2F;
scp  ~&#x2F;.ssh&#x2F;authorized_keys   node2:&#x2F;root&#x2F;.ssh&#x2F;
scp  ~&#x2F;.ssh&#x2F;authorized_keys   node3:&#x2F;root&#x2F;.ssh&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-JDK安装环境变量配置"><a href="#2-2-JDK安装环境变量配置" class="headerlink" title="2.2    JDK安装环境变量配置"></a>2.2    JDK安装环境变量配置</h3><p>node1-node4</p>
<pre class="line-numbers language-none"><code class="language-none">mkdir &#x2F;opt&#x2F;apps<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将jdk-8u221-linux-x64.rpm上传到node1/opt/apps<br>将/opt/apps下的jdk.rpm scp到node2、node3、node4的对应目录中</p>
<pre class="line-numbers language-none"><code class="language-none">scp jdk-8u221-linux-x64.rpm node2:&#x2F;opt&#x2F;apps
scp jdk-8u221-linux-x64.rpm node3:&#x2F;opt&#x2F;apps
scp jdk-8u221-linux-x64.rpm node4:&#x2F;opt&#x2F;apps<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在node1、node2、node3、node4上安装jdk并配置profile文件</p>
<pre class="line-numbers language-none"><code class="language-none">rpm -ivh jdk-8u221-linux-x64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>node1上修改环境变量</p>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;etc&#x2F;profile
export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;default
export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin
source &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>将node1的/etc/profile拷贝到node2、node3、node4上并执行. /etc/profile</p>
<pre class="line-numbers language-none"><code class="language-none">scp &#x2F;etc&#x2F;profile node[234]:&#96;pwd&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-3-ZooKeeper集群搭建"><a href="#2-3-ZooKeeper集群搭建" class="headerlink" title="2.3    ZooKeeper集群搭建"></a>2.3    ZooKeeper集群搭建</h3><p>a) 将ZooKeeper.tar.gz上传到node2<br>b) 解压到/opt</p>
<pre class="line-numbers language-none"><code class="language-none">tar -zxvf ZooKeeper-3.4.6.tar.gz -C &#x2F;opt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>c) 配置环境变量：</p>
<pre class="line-numbers language-none"><code class="language-none">export ZOOKEEPER_HOME&#x3D;&#x2F;opt&#x2F;zookeeper-3.4.6
export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$ZOOKEEPER_HOME&#x2F;bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后./etc/profile让配置生效<br>最后将该文件scp到node3和node4上，并分别./etc/profile让配置生效</p>
<pre class="line-numbers language-none"><code class="language-none">scp &#x2F;etc&#x2F;profile bk3:&#x2F;etc&#x2F;
scp &#x2F;etc&#x2F;profile bk4:&#x2F;etc&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>d) 到$ZooKeeper_HOME/conf下<br>复制zoo_sample.cfg为zoo.cfg</p>
<pre class="line-numbers language-none"><code class="language-none">cp zoo_sample.cfg  zoo.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>e) 编辑zoo.cfg<br>补充：参数说明<br><strong>tickTime</strong>=2000 #发送心跳的间隔时间，单位：毫秒<br><strong>dataDir</strong>=/opt/zookeeper-3.4.6/data #ZooKeeper保存数据的目录<br><strong>dataLogDir</strong>=/var/bjsxt/zookeeper/datalog #日志目录<br><strong>clientPort</strong>=2181<br><strong>initLimit</strong>=5 （follower或obsever 初始化连接leader最大间隔数）<br><strong>syncLimit</strong>=2 （leader和follower之间发送信息，请求和应答时间长度）<br>    server.1=server2:2881:3881<br>    server.2=server3:2881:3881<br>    server.3=node4:2881:3881  #observer（表示对应节点不参与投票）<br><strong>clientPort</strong>：客户端连接 ZooKeeper 服务器的端口，ZooKeeper  会监听这个端口，接受客户端的访问请求。<br><strong>initLimit</strong>： 这个配置项是用来配置 ZooKeeper 接受客户端（这里所说的客户端不是用户连接ZooKeeper服务器的客户端，而是 ZooKeeper 服务器集群中follower或observer连接到 Leader的Follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。当已经超过 5 个心跳的时间（也就是 tickTime）长度后 ZooKeeper 服务器还没有收到客户端的返回信息，那么表明这个客户端连接失败。总的时间长度就是 5*2000=10秒<br><strong>syncLimit</strong>：这个配置项标识 Leader 与 Follower 之间发送消息，请求和应答时间长度，最长不能超过多少个tickTime 的时间长度，总的时间长度就是 4*2000=8 秒<br><strong>server.A=B：C：D</strong>：其 中 A 是一个数字，表示这个是第几号服务器；B 是这个服务器的ip地址；C 表示的是这个服务器与集群中的Leader服务器交换信息的端口；D表示的是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。如果是伪集群的配置方式，由于B都是一样，所以不同的ZooKeeper实例通信端口号不能一样，所以要给它们分配不同的端口号</p>
<p>添加如下行：</p>
<pre class="line-numbers language-none"><code class="language-none">server.1&#x3D;node2:2881:3881
server.2&#x3D;node3:2881:3881
server.3&#x3D;node4:2881:3881<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>修改</p>
<pre class="line-numbers language-none"><code class="language-none">dataDir&#x3D;&#x2F;opt&#x2F;ZooKeeper-3.4.6&#x2F;data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>f) 创建/opt/ZooKeeper-3.4.6/data目录，并在该目录下放一个文件：myid<br>      在myid中写下当前ZooKeeper的编号</p>
<pre class="line-numbers language-none"><code class="language-none">mkdir &#x2F;opt&#x2F;zookeeper-3.4.6&#x2F;data
mkdir &#x2F;var&#x2F;bjsxt&#x2F;zookeeper&#x2F;datalog
echo 1 &gt; &#x2F;opt&#x2F;zookeeper-3.4.6&#x2F;data&#x2F;myid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>g)将配置好ZooKeeper拷贝到node3、node4上</p>
<pre class="line-numbers language-none"><code class="language-none">scp -r ZooKeeper-3.4.6&#x2F; node3:&#x2F;opt&#x2F;
scp -r ZooKeeper-3.4.6&#x2F; node4:&#x2F;opt&#x2F;

#配置zookeeper环境变量
export ZOOKEEPER_HOME&#x3D;&#x2F;opt&#x2F;zookeeper-3.4.6
export PATH&#x3D;$PATH:$ZOOKEEPER_HOME&#x2F;bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>h) 在node3和node4上分别修改：myid<br> node3</p>
<pre class="line-numbers language-none"><code class="language-none">echo 2 &gt; &#x2F;opt&#x2F;ZooKeeper-3.4.6&#x2F;data&#x2F;myid
2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>node4</p>
<pre class="line-numbers language-none"><code class="language-none">echo 3 &gt; &#x2F;opt&#x2F;ZooKeeper-3.4.6&#x2F;data&#x2F;myid
3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>i) 分别启动ZooKeeper</p>
<pre class="line-numbers language-none"><code class="language-none">zkServer.sh start 启动zk
zkServer.sh stop  停止zk
zkServer.sh status  查看zk状态
zkServer.sh start|stop|status<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>j) 关闭ZooKeeper</p>
<pre class="line-numbers language-none"><code class="language-none">zkServer.sh stop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>l) 连接ZooKeeper</p>
<pre class="line-numbers language-none"><code class="language-none">zkCli.sh     node2、node3、node4都可以<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>m) 退出zkCli.sh命令</p>
<pre class="line-numbers language-none"><code class="language-none">quit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>提供集群模式的服务:<br>原子性<br>    准确的反馈成功或失败<br>一致性<br>    每个server都有统一的数据视图<br>可用性<br>    节点故障不影响使用    少于一半的宕机，没问题<br>网络分区/脑裂：过半通过<br>谁年龄大myid：<br>    1 2 3  （同时启动）<br>    1 2   3   （逐一启动）<br>谁数据新：<br>    3 3 4  事务id（zxid）大的当领导</p>
<p> 3台机器 挂一台    2&gt;3/2<br> 5台机器 挂了1台 4&gt;5/2（可以工作） 挂3台 2！&gt;5/2（集群无法工作）<br>顺序性：FIFO 使用消息队列先进先出</p>
<p>主从模型<br>    Leader  Follower+<br>    一写多读<br>        Leader负责增删改，Follower负责读和投票</p>
<p>集群状态<br>    选举模式  安其内<br>    广播模式  壤其外<br>Server状态<br>    LOOKING：当前Server不知道leader是谁，正在搜寻<br>    LEADING：当前Server即为选举出来的leader<br>    FOLLOWING：leader已经选举出来，当前Server与之同步<br>主从分工<br>    领导者（leader）<br>            负责进行投票的发起和决议，更新系统状态，（增删改）<br>    学习者（learner）<br>        包括跟随者（follower）和观察者（observer），follower用于接受客户端请求并向客户端返回结果，在操作过程中参与投票<br>    Observer<br>        可以接受客户端连接，将写请求转发给leader，但observer不参加投票过程，只同步leader的状态，observer的目的是为了扩展系统，提高读取速度<br>    客户端（client）<br>            请求发起方</p>
<h2 id="3-ZooKeeper进阶"><a href="#3-ZooKeeper进阶" class="headerlink" title="3    ZooKeeper进阶"></a>3    ZooKeeper进阶</h2><h3 id="3-1-Znode数据结构"><a href="#3-1-Znode数据结构" class="headerlink" title="3.1    Znode数据结构"></a>3.1    Znode数据结构</h3><p><a target="_blank" rel="noopener" href="https://ibb.co/ZKv8KtF">Znode数据结构</a></p>
<ol>
<li>   ZK有一个最开始的节点 /</li>
<li>   ZK的节点叫做znode节点</li>
<li>   每个znode节点都可存储数据</li>
<li>   每个znode节点（临时节点除外）都可创建自己的子节点</li>
<li>   多个znode节点共同形成了znode树</li>
<li>   Znode树的维系实在内存中，目的是供用户快速的查询</li>
<li>   每个znode节点都是一个路径（通过路径来定位这个节点）</li>
<li>   每个路径名都是唯一的。</li>
</ol>
<h4 id="3-1-1-目录结构"><a href="#3-1-1-目录结构" class="headerlink" title="3.1.1    目录结构"></a>3.1.1    目录结构</h4><p>层次的，目录型结构，便于管理逻辑关系<br>znode信息<br>    包含最大1MB的数据信息<br>    记录了zxid等元数据信息</p>
<h4 id="3-1-2-节点类型"><a href="#3-1-2-节点类型" class="headerlink" title="3.1.2    节点类型"></a>3.1.2    节点类型</h4><p>znode有两种类型，临时的（ephemeral）和持久的（persistent）<br>znode支持序列SEQUENTIAL<br>    临时znode<br>        客户端会话结束时，ZooKeeper将该临时znode删除，临时znode没有子节点<br>    持久znode<br>        不依赖于客户端会话，只有当客户端明确要删除该持久znode时才会被删除<br>    znode的类型在创建时确定并且之后不能再修改</p>
<pre><code>有序znode节点被分配唯一单调递增的整数。
    比如：客户端创建有序znode，路径为/task/task-，则ZooKeeper为其分配序号1，并追加到znode节点：
    /task/task-000000001。有序znode节点唯一，同时也可根据该序号查看znode创建顺序。
</code></pre>
<p>znode有四种形式的目录节点<br>    PERSISTENT：普通持久<br>    EPHEMERAL：普通临时<br>    PERSISTENT_SEQUENTIAL：顺序持久<br>    EPHEMERAL_SEQUENTIAL：顺序临时</p>
<p>要想执行以下指令，需要先启动zk服务器端，再启动zk客户端<br>    ./zkServer.sh start:启动zk服务器端<br>    ./zkCli.sh：启动zk客户端</p>
<h3 id="3-2-ZK客户端命令行操作"><a href="#3-2-ZK客户端命令行操作" class="headerlink" title="3.2    ZK客户端命令行操作"></a>3.2    ZK客户端命令行操作</h3><table>
<thead>
<tr>
<th>指令</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>ls查看指令</td>
<td>ls /</td>
</tr>
<tr>
<td>create创建节点指令，注意，在创建节点时，要分配初始数据。</td>
<td>create创建节点指令，注意，在创建节点时，要分配初始数据。    create /zk01/ hellocreate /zk02 ‘’</td>
</tr>
<tr>
<td>get查看节点数据指令；<br>hello  数据 <br>cZxid = 0x2 <br>ctime = Mon May 15 05:58:32 PDT 2017 <br>创建节点的时间戳 mZxid = 0x2 <br>mtime = Mon May 15 05:58:32 PDT 2017 <br>修改此节点数据的最新时间戳 <br>pZxid = 0x2 cversion = 0 dataVersion = 0 <br>数据版本号，每当数据发生变化，版本号递增1 <br>aclVersion = 0 ephemeralOwner = 0x0 <br>dataLength = 5数据大小  <br>numChildren = 0子节点个数</td>
<td>get /zk01</td>
</tr>
<tr>
<td>set更新节点数据指令(执行后mtime、dataVersion肯定会放生变化，dataLength可能会变化)</td>
<td>set /zk01 hellozk</td>
</tr>
<tr>
<td>delete删除节点</td>
<td>delete /zk01</td>
</tr>
<tr>
<td>create指令补充：<br>1.    创建子节点 <br> 2.Zk节点分四种类型:分别是：：普通持久节点:普通临时节点：创建此临时节点的客户端失去和zk连接后，此节点消失.zk是通过临时节点监控哪个服务器挂掉的。  <br>  顺序持久节点：会根据用户指定的节点路径，自动分配一个递增的顺序号。（顺序节点实现分布式锁的效果，服务器1抢到zk05分配zk050001，服务器2抢到zk05分配zk050002） <br>  顺序临时节点：</td>
<td>1.create /zk01/node01 hello  <br>2.<br>    2.1．create /zk01 hello <br>    2.2. create –e /zk02 abc  <br>    2.3.create –s /zk03 abc  <br>    2.4.create –s -e /zk05 abcd zk050000000003 再创建一个就是：zk050000000004</td>
</tr>
</tbody></table>
<h3 id="3-3-ZooKeeper会话"><a href="#3-3-ZooKeeper会话" class="headerlink" title="3.3    ZooKeeper会话"></a>3.3    ZooKeeper会话</h3><ol>
<li>客户端通过TCP协议与独立服务器或者一个集群中的某个服务器建立会话连接。</li>
<li>会话提供顺序保障，即同一个会话中的请求以FIFO的顺序执行。如果客户端有多个并发会话，FIFO顺序在多个会话之间未必能够保持。</li>
<li>如果连接的Server出现问题，在没有超过Timeout时间时，可以连接其他节点。ZooKeeper客户端透明地转移一个会话到不同的服务器。</li>
<li>同一session期内的特性不变</li>
<li>当一个会话因某种原因终止，在这个会话期间创建的临时节点将会消失。<strong>Session是由谁来创建的？</strong>Leader：产生一个唯一的session，放到消息队列，让所有server知道过半机制：保证session创建成功或者失败</li>
</ol>
<h3 id="3-4-事件监听原理刨析"><a href="#3-4-事件监听原理刨析" class="headerlink" title="3.4    事件监听原理刨析"></a>3.4    事件监听原理刨析</h3><p>客户端轮询指定节点下的数据<br>通过网络轮询，代价很大<br><a target="_blank" rel="noopener" href="https://ibb.co/nbKSTt5">监听机制</a></p>
<p>基于通知（notification）的机制：<br><a target="_blank" rel="noopener" href="https://ibb.co/twrrw6M">图例</a><br>    客户端向ZooKeeper注册需要接收通知的znode，<br>通过对znode设置监视点（watch）来接收通知。监视点是一个单次触发的操作，意即监视点会触发一个通知。<br>    为了接收多个通知，客户端必须在每次通知后设置一个新的监视点</p>
<p>事件监听Watcher<br>    Watcher 在 ZooKeeper 是一个核心功能，Watcher 可以监控目录节点的数据变化以及子目录的变化，一旦这些状态发生变化，服务器就会通知所有设置在这个目录节点上的Watcher，从而每个客户端都很快知道它所关注的目录节点的状态发生变化，而做出相应的反应。<br>    可以设置观察点的操作：exists,getChildren,getData<br>    可以触发观察的操作：create,delete,setData</p>
<p>回调client方法<br>业务核心代码在哪里？<br>     client</p>
<h3 id="3-5-广播模式刨析"><a href="#3-5-广播模式刨析" class="headerlink" title="3.5    广播模式刨析"></a>3.5    广播模式刨析</h3><p><a target="_blank" rel="noopener" href="https://ibb.co/pjfML9k">广播机制</a><br>ZooKeeper的核心是原子广播，这个机制保证了各个server之间的信息同步。实现这个机制的协议叫做ZAB协议。<br>ZAB协议有两种模式：<br>1.恢复模式：当服务启动或者在领导者崩溃后，ZAB就进入了恢复模式。当领导者被选举出来，且大多数server的完成了和leader的状态同步以后，恢复模式就结束了。状态同步保证了leader和follower以及observer具有相同的系统状态<br>2.广播模式<br>广播模式需要保证proposal被按顺序处理，因此zk采用了递增的事务id号(zxid)来保证。所有的提议(proposal)都在被提出的时候加上了zxid(比如：0x1000000300000002)。<br>epoch也称为纪元数字。实现中zxid是一个64位的数字，它高32位是epoch用来标识leader关系是否改变，每次一个leader被选出来，它都会有一个新的epoch，低32位是个递增计数。</p>
<h3 id="3-6-Zookeeper集群的特点"><a href="#3-6-Zookeeper集群的特点" class="headerlink" title="3.6    Zookeeper集群的特点"></a>3.6    Zookeeper集群的特点</h3><p><a target="_blank" rel="noopener" href="https://ibb.co/B38gPCC">特点</a><br>•    角色模型<br>    –    集群状态（可用/不可用）<br>    –    主从分工<br>•    攘其外：<br>    –    统一视图<br>        •    会话session<br>        •    数据模型Znode<br>            –    目录结构<br>            –    节点类型<br>    –    事件监听Watcher<br>•    原理：<br>    –    原子消息广播协议ZAB<br>    •    paxos<br>        –    journalnode<br>        –    Sentinel (redis 哨兵）<br>        –    ZooKeeper   ZAB<br>    •    zxid ,myid：<br>    •    ZXID:epoch+ID<br>    –    广播模式原理<br>    –    恢复模式原理：无主模型：zab： zxid ,myid</p>
<p>无主，无服务。选举过程耗时在200ms之内，一般情况下ZooKeeper恢复服务时间间隔不超过200ms</p>
<h3 id="3-7-ZK常见的应用场景"><a href="#3-7-ZK常见的应用场景" class="headerlink" title="3.7    ZK常见的应用场景"></a>3.7    ZK常见的应用场景</h3><ol>
<li>   分布式环境下的统一命名服务<br><a target="_blank" rel="noopener" href="https://ibb.co/dg67P75">示例</a></li>
<li> 分布式环境下的配置管理<br><a target="_blank" rel="noopener" href="https://ibb.co/8jv8y1x">示例</a></li>
<li>   数据发布/订阅</li>
<li>   分布式环境下的分布式锁</li>
<li>   集群管理问题</li>
</ol>
<h2 id="4-ZK-API实战"><a href="#4-ZK-API实战" class="headerlink" title="4    ZK API实战"></a>4    ZK API实战</h2><h3 id="4-1-IDEA环境搭建"><a href="#4-1-IDEA环境搭建" class="headerlink" title="4.1    IDEA环境搭建"></a>4.1    IDEA环境搭建</h3><ol>
<li>   新建project</li>
<li>   将log4j.properties文件拷贝到项目的src目录</li>
<li>   项目的根目录新建lib文件夹，将jar包拷贝到该目录下。</li>
<li>   File-&gt; -&gt;Libaries</li>
<li>   新建包</li>
</ol>
<h3 id="4-2-创建ZooKeeper客户端"><a href="#4-2-创建ZooKeeper客户端" class="headerlink" title="4.2    创建ZooKeeper客户端"></a>4.2    创建ZooKeeper客户端</h3><p>在该包下新建类ZooKeeperTest<br>略&gt;&gt; 该部分为java 不会  》》 可用Python代替</p>
<p>python可以用 KazooClient 模块实现功能<br><a target="_blank" rel="noopener" href="https://www.helloworld.net/p/7482175713">代码示例</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> kazoo<span class="token punctuation">.</span>client <span class="token keyword">import</span>  KazooClient<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">tangyuan</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://tangyuan59.github.io/2021/12/21/zookeeper/">http://tangyuan59.github.io/2021/12/21/zookeeper/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">tangyuan</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/ZooKeeper/">
                                    <span class="chip bg-color">ZooKeeper</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/12/22/hadoop-ji-chu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="hadoop基础">
                        
                        <span class="card-title">hadoop基础</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-12-22
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="post-category">
                                    大数据
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Hadoop/">
                        <span class="chip bg-color">Hadoop</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/12/21/nginx/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="Nginx">
                        
                        <span class="card-title">Nginx</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-12-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="post-category">
                                    大数据
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Nginx/">
                        <span class="chip bg-color">Nginx</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <a href="/about" target="_blank">tangyuan</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">37.8k</span>
            
            
            
            
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/tangyuan59/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1010337861@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1010337861" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1010337861" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
