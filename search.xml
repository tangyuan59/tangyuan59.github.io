<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>舆情分析</title>
      <link href="/2021/12/21/yu-qing-fen-xi/"/>
      <url>/2021/12/21/yu-qing-fen-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="tap爬虫"><a href="#tap爬虫" class="headerlink" title="tap爬虫"></a>tap爬虫</h1><h2 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h2><ul><li>获取玩家反馈基调,分析玩家全体关注点;</li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> os<span class="token keyword">import</span> time<span class="token keyword">import</span> json<span class="token keyword">import</span> random<span class="token keyword">import</span> random<span class="token keyword">import</span> requests<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree<span class="token comment"># 请求头</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"User_Agent"</span> <span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36"</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">tapspider</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token builtin">id</span><span class="token punctuation">,</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span>         self<span class="token punctuation">.</span>page <span class="token operator">=</span> page         self<span class="token punctuation">.</span><span class="token builtin">list</span> <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">get_url_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>            url <span class="token operator">=</span> <span class="token string">'https://www.taptap.com/app/'</span> <span class="token operator">+</span> \                <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'/topic?type=feed&amp;sort=created&amp;page='</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>            request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>            <span class="token comment"># xpath解析获取玩家详情页</span>            xpath_data <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>request<span class="token punctuation">.</span>content<span class="token punctuation">)</span>            <span class="token comment"># 获得用户帖子详情页</span>            playerid_url <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                <span class="token string">'//div[@class="common-v2-list topic-item common-box-card js-ugc-item js-moment-item"]/@href'</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>playerid_url<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">parse_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        ame_list<span class="token punctuation">,</span> create_time_list<span class="token punctuation">,</span> label_list<span class="token punctuation">,</span> play_time_list<span class="token punctuation">,</span> title_list<span class="token punctuation">,</span> content_list<span class="token punctuation">,</span> img_list<span class="token punctuation">,</span> reply_list <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> url <span class="token keyword">in</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'topic'</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>                request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>                xpath_data <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>request<span class="token punctuation">.</span>content<span class="token punctuation">)</span>                <span class="token comment"># 玩家昵称</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    name <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                        <span class="token string">'//div/a[@class="user-name "]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                    name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>                    name <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                        <span class="token string">'//div/div[@class="user-name-identity topic-author__app"]/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                    name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                <span class="token comment"># 帖子创建时间</span>                create_time <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div/ul/li/span/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                create_time <span class="token operator">=</span> create_time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>                create_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>                <span class="token comment"># 帖子所属的分区</span>                label <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                    <span class="token string">'//li[@class="topic-main_labels"]/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                label_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>                <span class="token comment"># 玩家游戏时间</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    playtime <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                        <span class="token string">'//li/span[@class="text-score-time"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                    play_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>playtime<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    play_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>                    <span class="token comment"># 帖子标题</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    title <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                        <span class="token string">'//div[@class="top-title-author"]/./p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>                    title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span>                    <span class="token comment"># 帖子内容</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    content <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                        <span class="token string">'//div/div[@class="bbcode-body bbcode-body-v2 js-open-bbcode-image js-translate-content"]//text()'</span><span class="token punctuation">)</span>                    etmpy <span class="token operator">=</span> <span class="token string">''</span>                    <span class="token keyword">for</span> text <span class="token keyword">in</span> content<span class="token punctuation">:</span>                        etmpy <span class="token operator">=</span> etmpy<span class="token operator">+</span><span class="token string">' '</span> <span class="token operator">+</span> \                            re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">"(\s)|(\n)|(' ')|(,)"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>                        content <span class="token operator">=</span> etmpy                    content_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>content<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'con'</span><span class="token punctuation">)</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    <span class="token comment"># 图片链接</span>                    img <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div/div/img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>                    img_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'img'</span><span class="token punctuation">)</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    <span class="token comment"># 回复</span>                    reply <span class="token operator">=</span> xpath_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>                        <span class="token string">'//div/div/div[@class="item-text-body bbcode-body bbcode-body-v2 js-open-bbcode-image"]/text()'</span><span class="token punctuation">)</span>                    reply_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>reply<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'re'</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token comment">#解析json</span>                <span class="token keyword">if</span> <span class="token string">'video'</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>                    <span class="token builtin">id</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'\d+'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>                    user_url <span class="token operator">=</span> <span class="token string">'https://www.taptap.com/webapiv2/video/v2/detail?id='</span><span class="token operator">+</span><span class="token builtin">id</span> <span class="token operator">+</span> \                        <span class="token string">'&amp;X-UA=V%3D1%26PN%3DWebApp%26LANG%3Dzh_CN%26VN_CODE%3D3%26VN%3D0.1.0%26LOC%3DCN%26PLT%3DPC%26DS%3DAndroid%26UID%3D7d018504-3322-4788-8c64-024ea433da5d%26VID%3D345765606%26DT%3DPC'</span>                <span class="token comment"># 解析网址</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token builtin">id</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'\d+'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>                    user_url <span class="token operator">=</span> <span class="token string">'https://www.taptap.com/webapiv2/moment/v2/detail?id='</span> <span class="token operator">+</span> <span class="token builtin">id</span> <span class="token operator">+</span> \                        <span class="token string">'&amp;X-UA=V%3D1%26PN%3DWebApp%26LANG%3Dzh_CN%26VN_CODE%3D3%26VN%3D0.1.0%26LOC%3DCN%26PLT%3DPC%26DS%3DAndroid%26UID%3D7d018504-3322-4788-8c64-024ea433da5d%26VID%3D345765606%26DT%3DPC'</span>                    <span class="token comment"># 解析网</span>                request <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>user_url<span class="token punctuation">)</span>                response <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">#用户昵称</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    name <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'author'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>                    name_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    name <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'author'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>                    namelist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name_<span class="token punctuation">)</span>                <span class="token comment"># 帖子创建时间</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    create_time <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'created_time'</span><span class="token punctuation">]</span>                    time_local <span class="token operator">=</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>                    <span class="token comment"># 转换成新的时间格式()</span>                    create_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y/%m/%d"</span><span class="token punctuation">,</span> time_local<span class="token punctuation">)</span>                    create_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>                <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>                    create_time <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'created_time'</span><span class="token punctuation">]</span>                    time_local <span class="token operator">=</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>                    <span class="token comment"># 转换成新的时间格式()</span>                    create_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y/%m/%d"</span><span class="token punctuation">,</span> time_local<span class="token punctuation">)</span>                    create_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>create_time<span class="token punctuation">)</span>                <span class="token keyword">except</span><span class="token punctuation">:</span>                    play_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token comment">#游戏时长</span>                play_time_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>                <span class="token comment">#帖子分区</span>                label <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'groups'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'group_label'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>                label_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>                <span class="token comment">#图片链接</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    img <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'extended_entities'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>                    img_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>                <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>                    img_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>                <span class="token comment">### 标题</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    title <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sharing'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span>                    title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">)</span>                <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>                    title <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'extended_entities'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'videos'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>                    title_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title<span class="token punctuation">)</span>                <span class="token comment"># 内容</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    content <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'moment'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'contents'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'raw_text'</span><span class="token punctuation">]</span>                    content_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>content<span class="token punctuation">)</span>                <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>                    content <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'intro'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span>                    pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[\u4e00-\u9fa5].*\Z'</span><span class="token punctuation">)</span>                    content <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>                    content <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'&lt;/p>'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>                    content_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>content<span class="token punctuation">)</span>                <span class="token comment">#回复</span>                reply_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>             <span class="token comment"># 休眠</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># 保存为字典</span>        data_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> name_list<span class="token punctuation">,</span> <span class="token string">"createtime"</span><span class="token punctuation">:</span> create_time_list<span class="token punctuation">,</span> <span class="token string">"label"</span><span class="token punctuation">:</span> label_list<span class="token punctuation">,</span> <span class="token string">"playtime"</span><span class="token punctuation">:</span> play_time_list<span class="token punctuation">,</span>                     <span class="token string">"title"</span><span class="token punctuation">:</span> title_list<span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> content_list<span class="token punctuation">,</span> <span class="token string">"img"</span><span class="token punctuation">:</span> img_list<span class="token punctuation">,</span> <span class="token string">"reply"</span><span class="token punctuation">:</span> reply_list<span class="token punctuation">,</span> <span class="token string">"user_url"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> data_dict    <span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        path <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>        filepath <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">'\%s.json'</span> <span class="token operator">%</span> name<span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">,</span> filepath<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        excel_path<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">'%s.xlsx'</span><span class="token operator">%</span>name<span class="token punctuation">)</span>        excel <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>excel_path<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'\%s.json'</span> <span class="token operator">%</span> name<span class="token punctuation">,</span>excel_path<span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> self<span class="token punctuation">.</span>parse_list<span class="token punctuation">(</span><span class="token punctuation">)</span>        json <span class="token operator">=</span> self<span class="token punctuation">.</span>save<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="数据展示"><a href="#数据展示" class="headerlink" title="数据展示"></a>数据展示</h2><p><img src="tap.jpg"></p><h2 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h2><object data="./舆情分析/社区舆情分析报告.pdf" type="application/pdf" width="100%" height="80%">]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
